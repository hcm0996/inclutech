<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Traductor de Se√±as Demo LSC</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Fuente amigable -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      background: #a0d8f1; /* azul claro amigable */
      font-family: 'Poppins', sans-serif;
    }
    h1 { font-weight: 600; color:#034f84; }
    #output { border:1px solid #ccc; border-radius:12px; }
    #label { font-size:2rem; margin-top:10px; }
    .btn { font-weight:600; }
  </style>
</head>
<body>
<div class="container py-5">
  <h1 class="text-center mb-4">Traductor de Se√±as Demo LSC</h1>
  <div class="d-flex justify-content-center mb-3">
    <video id="video" width="640" height="480" autoplay muted class="d-none"></video>
    <canvas id="output" width="640" height="480" class="shadow-sm"></canvas>
  </div>
  <div class="text-center">
    <div id="label" class="alert alert-primary py-2">‚Ä¶</div>
    <button id="resetBtn" class="btn btn-warning mt-2">Reiniciar secuencia</button>
  </div>
</div>

<!-- MediaPipe Hands -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>


<script>
    
const video = document.getElementById('video');
const canvas = document.getElementById('output');
const ctx = canvas.getContext('2d');
const labelEl = document.getElementById('label');
const resetBtn = document.getElementById('resetBtn');

// Configuraci√≥n MediaPipe Hands
const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
hands.setOptions({ maxNumHands:1, modelComplexity:1, minDetectionConfidence:0.6, minTrackingConfidence:0.6 });
hands.onResults(onResults);

const camera = new Camera(video, { onFrame: async()=>{ await hands.send({image:video}); }, width:640, height:480 });
camera.start().catch(err=>{ console.error(err); labelEl.textContent='Permite la c√°mara'; });

// Funciones auxiliares
function dist(a,b){ return Math.hypot(a.x-b.x,a.y-b.y); }
function fingerExtended(lm,tip,pip){ return lm[tip].y<lm[pip].y; }
function thumbExtended(lm,handedness){
  if(!handedness) return false;
  const isRight = handedness.label==='Right';
  return isRight ? (lm[4].x<lm[3].x) : (lm[4].x>lm[3].x);
}
function drawLandmarksAndConnectors(ctx,lm){
  drawConnectors(ctx,lm,HAND_CONNECTIONS,{lineWidth:3});
  drawLandmarks(ctx,lm,{lineWidth:1,radius:3});
}

// Clasificador de gestos
function classifyGesture(lm, handedness){
  const indexExt = fingerExtended(lm,8,6);
  const middleExt = fingerExtended(lm,12,10);
  const ringExt = fingerExtended(lm,16,14);
  const pinkyExt = fingerExtended(lm,20,18);
  const thumbExt = thumbExtended(lm,handedness);
  const extendedCount = [indexExt,middleExt,ringExt,pinkyExt].filter(Boolean).length;
  const thumbIndexDist = dist(lm[4],lm[8]);
  const okShape = (thumbIndexDist<0.07) && !middleExt;

  if(extendedCount===4 && thumbExt) return 'Hola';
  if(extendedCount===0) return 'A';
  if(okShape) return 'C';
  if(extendedCount===4 && !thumbExt) return 'B';
  return '‚Ä¶';
}

// Variables de estabilizaci√≥n
let stableLabel='‚Ä¶', lastLabel=null, sameCount=0;
const THRESH_STABLE=4;

// Secuencia "Buenos d√≠as"
let gestureSequence=[];
const MAX_SEQUENCE=10;
let buenosDiasTimeout = null;

function updateSequence(label){
  if(label && label!=='‚Ä¶'){
    gestureSequence.push(label);
    if(gestureSequence.length>MAX_SEQUENCE) gestureSequence.shift();
  }
}

function checkBuenosDias(){
  const seq = gestureSequence.join(',');
  return seq.includes('B,C');
}

// Reiniciar secuencia
resetBtn.addEventListener('click', ()=>{ gestureSequence=[]; labelEl.textContent='‚Ä¶'; });

// Funci√≥n principal
function onResults(results){
  ctx.save();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(results.image,0,0,canvas.width,canvas.height);

  let current='‚Äî';
  if(results.multiHandLandmarks && results.multiHandLandmarks.length>0){
    const lm = results.multiHandLandmarks[0];
    const hd = results.multiHandedness?.[0];
    drawLandmarksAndConnectors(ctx,lm);
    current = classifyGesture(lm,hd);
  }

  if(current===lastLabel){ sameCount++; if(sameCount>=THRESH_STABLE) stableLabel=current; }
  else{ lastLabel=current; sameCount=1; }

  updateSequence(stableLabel);

  // Manejo de "Buenos d√≠as" 6 segundos
  if(checkBuenosDias() && !buenosDiasTimeout){
    labelEl.textContent='Buenos d√≠as üåû';
    buenosDiasTimeout = setTimeout(() => {
      buenosDiasTimeout = null;
    }, 3000);
  } else if(!buenosDiasTimeout){
    labelEl.textContent=stableLabel;
  }

  ctx.restore();
}
</script>
</body>
</html>
